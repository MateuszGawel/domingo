{% extends 'main/_layout/base.html' %}

{% block content %}

{% include 'main/_layout/report_menu.html' with active_tab="alerts" %}

{% if inc_id != None %} DODAJE DO INCYDENTU O ID: {{ inc_id }} {% endif %}

{% if inc_id == None %}
    <form class="filters form-inline well" action=" {% url 'reports:alert_tab' report.rep_id %} " method="post">
{% else %}
    <form class="filters form-inline well" action=" {% url 'reports:incident_alert_tab' inc_id %} " method="post">
{% endif %}

        {% csrf_token %}
        {{ alertForm }}
        {{ error_message }}

        <button class='btn btn-success navbar-right' type='submit'>Add</button>
    </form>
    {% if inc_id == None %}
        <form class="" action="{% url 'reports:get_alerts_from_jira' report.rep_id %}" method="post">
            {% csrf_token %}
            {{ error_message }}
            <button class='btn btn-warning navbar-right' type='submit'>Get from Jira</button>
        </form>

        <table id="alertTable" class='table table-bordered table-striped table-hover'>
            <thead>
                <tr>
                    <th>Project</th>
                    <th>Sensor</th>
                    <th>Ticket</th>
                    <th>Data</th>
                    <th>Type</th>
                    <th>Comment</th>
                    <th></th>
                </tr>
            </thead>

            <tbody>
                {% for alert in alerts %}
                    <tr>
                    <form action="{% url 'alerts:quick_edit' report.rep_id alert.0.alt_id%}" method="post">
                        {% csrf_token %}
                        {% for field in alert.1.visible_fields %}
                            <td class='alertForm-view alertForm-view{{ alert.0.alt_id }}' style="display: none">{{ field }}</td>
                        {% endfor %}

                        <td class="alert-view{{ alert.0.alt_id }}">{{ alert.0.alt_prj_id.prj_name }}</td>
                        <td class="alert-view{{ alert.0.alt_id }}">{{ alert.0.alt_name }}</td>
                        <td class="alert-view{{ alert.0.alt_id }}">{{ alert.0.alt_ticket }}</td>
                        <td class="alert-view{{ alert.0.alt_id }}">{{ alert.0.alt_date }}</td>
                        <td class="alert-view{{ alert.0.alt_id }}">{{ alert.0.alt_type }}</td>
                        <td class="alert-view{{ alert.0.alt_id }}">{{ alert.0.alt_com_id.com_value }}</td>
                        <td>
                        <button class='alertForm-view{{ alert.0.alt_id }} btn btn-success' style="display: none">Save</button>
                    </form>
                            <a class='alert-view{{ alert.0.alt_id }} btn btn-primary' href="{% url 'alerts:details' report.rep_id alert.0.alt_id %}">Details</a>
                            <form class="alert-view{{ alert.0.alt_id }}" action="{% url 'alerts:remove_alert' report.rep_id alert.0.alt_id %}" method="post">
                                {% csrf_token %}
                                {{ error_message }}
                                <button class='btn btn-danger' type='submit'>Remove</button>
                            </form>
                            <button class='alert-view{{ alert.0.alt_id }} edit-button btn btn-warning' onclick="switchToAlertFormView({{ alert.0.alt_id }})">Edit</button>
                            <button class='alertForm-view{{ alert.0.alt_id }} btn btn-danger' style="display: none" onclick="switchToAlertView({{ alert.0.alt_id }})">Cancel</button>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {%  endif %}
{% endblock %}