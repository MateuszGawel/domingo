{% extends 'main/_layout/base.html' %}

{% block content %}

    <form action="{% url 'reports:close' report.rep_id %}" method="post">
        {% csrf_token %}
        <button class='btn btn-danger' type='submit' style="margin-bottom: 20px">Close report</button>
    </form>


    <ul class="nav nav-tabs">
        <li><a href="{% url 'reports:alert_tab' report.rep_id %}">Alerts</a></li>
        <li><a href="{% url 'reports:contact_tab' report.rep_id %}">Contacts</a></li>
        <li class="active"><a href="{% url 'reports:incident_tab' report.rep_id %}">Incidents</a></li>
    </ul>



    <form class="filters form-inline well" action="{% url 'reports:incident_tab' report.rep_id %}" method="post">
        {% csrf_token %}

        {{ incidentForm.inc_prj_id.errors }}
        {{ incidentForm.inc_prj_id }}
        {{ incidentForm.inc_ticket.errors }}
        {{ incidentForm.inc_ticket }}
        {{ incidentForm.inc_date_start.errors }}
        {{ incidentForm.inc_date_start }}
        {{ incidentForm.inc_com_id.errors }}
        {{ incidentForm.inc_com_id }}
        {{ error_message }}
        <button class='btn btn-success navbar-right' type='submit'><i class="glyphicon glyphicon-circle-ok"></i>Open</button>
    </form>
    <table class='table table-bordered table-striped table-hover'>
        <thead>
            <tr>
                <th>Project</th>
                <th>Ticket</th>
                <th>Status</th>
                <th>Start date</th>
                <th>Resolve date</th>
                <th>Comment</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for incident in incidents %}
                <tr>
                    <td>{{ incident.inc_prj_id.prj_name }}</td>
                    <td>{{ incident.inc_ticket }}</td>
                    <td>{{ incident.inc_status }}</td>
                    <td>{{ incident.inc_date_start }}</td>
                    <td>{{ incident.inc_date_end }}</td>
                    <td>{{ incident.inc_com_id.com_value }}</td>
                    <td>
                        <a class='btn btn-primary' href="{% url 'incidents:details' incident.inc_id %}">Details</a>

                        {% if incident.inc_status == 'O' %}
                            <form action="{% url 'incidents:close' report.rep_id incident.inc_id %}" method="post">
                                {% csrf_token %}
                                <button class='btn btn-danger' type='submit' style="margin-bottom: 20px">Resolve incident</button>
                            </form>
                        {% endif %}
                        {%  if incident.inc_status == 'O' or incident.inc_status == 'R' %}
                            <form action="{% url 'incidents:invalidate' report.rep_id incident.inc_id %}" method="post">
                                {% csrf_token %}
                                <button class='btn btn-warning' type='submit' style="margin-bottom: 20px">Invalidate incident</button>
                            </form>
                        {% endif %}
                        {%  if incident.inc_status == 'R' or incident.inc_status == 'I' %}
                            <form action="{% url 'incidents:reopen' report.rep_id incident.inc_id %}" method="post">
                                {% csrf_token %}
                                <button class='btn btn-success' type='submit' style="margin-bottom: 20px">Reopen incident</button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

{% endblock %}