{% extends 'main/_layout/base.html' %}

{% block content %}

{% include 'main/_layout/report_menu.html' with active_tab="incidents" %}



    <form class="filters form-inline well col-md-3" action="{% url 'reports:incident_tab' report.rep_id %}" method="post">
        {% csrf_token %}

        {{ incidentForm.inc_prj_id.errors }}
        {{ incidentForm.inc_prj_id }}
        {{ incidentForm.inc_ticket.errors }}
        {{ incidentForm.inc_ticket }}
        {{ incidentForm.inc_date_start.errors }}
        {{ incidentForm.inc_date_start }}
        {{ incidentForm.inc_com_id.errors }}
        {{ incidentForm.inc_com_id }}
        {{ error_message }}
        <button class='btn button_style_1 col-md-offset-4 col-md-4 col-md-offset-4' type='submit'><i class="glyphicon glyphicon-circle-ok"></i>Open</button>
    </form>
        <div class="col-md-9">
            <table class='table table-bordered table-striped table-hover'>
                <thead>
                    <tr>
                        <th>Project</th>
                        <th>Ticket</th>
                        <th>Status</th>
                        <th>Start date</th>
                        <th>Resolve date</th>
                        <th>Comment</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for incident in incidents %}
                        <tr>
                            <td>{{ incident.inc_prj_id.prj_name }}</td>
                            <td>{{ incident.inc_ticket }}</td>
                            <td>{{ incident.get_inc_status_display }}</td>
                            <td>{{ incident.inc_date_start }}</td>
                            <td>{% if incident.inc_date_end != None %} {{ incident.inc_date_end }} {% endif %}</td>
                            <td>{{ incident.inc_com_id.com_value }}</td>
                            <td>
                                <a class='btn button_style_1 col-md-12' href="{% url 'incidents:details' report.rep_id incident.inc_id %}"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> Details</a>
                                {%  if incident.inc_status == 'O' or incident.inc_status == 'R' %}
                                    <form action="{% url 'incidents:invalidate' report.rep_id incident.inc_id %}" method="post">
                                        {% csrf_token %}
                                        <button class='btn button_style_1 col-md-12 rem_but' type='submit' style=""><span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span> Invalidate incident</button>
                                    </form>
                                {% endif %}
                                {% if incident.inc_status == 'O' %}
                                    <form action="{% url 'incidents:close' report.rep_id incident.inc_id %}" method="post">
                                        {% csrf_token %}
                                        <button class='btn button_style_1 col-md-12 button_style_logout rem_but' type='submit' style="margin-bottom: 20px"><span class="glyphicon glyphicon-check" aria-hidden="true"></span> Resolve incident</button>
                                    </form>
                                {% endif %}
                                {%  if incident.inc_status == 'R' or incident.inc_status == 'I' %}
                                    <form action="{% url 'incidents:reopen' report.rep_id incident.inc_id %}" method="post">
                                        {% csrf_token %}
                                        <button class='btn button_style_1 col-md-12 rem_but' type='submit' style="margin-bottom: 20px"><span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Reopen incident</button>
                                    </form>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

{% endblock %}