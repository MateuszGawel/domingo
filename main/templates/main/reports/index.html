{% extends "main/_layout/base.html" %}

{% block sidemenu %}
    {% include "main/_layout/side_menu.html" with active="reports" %}
{% endblock %}

{% block content %}
    <div class="col-md-8 col-md-offset-4">
        <div class="row">
            <h1>CREATE REPORT</h1>
            {% if report == None %}
                <span style="color: green">You have no reports yet</span><br>

                <form action="{% url 'reports:create' %}" method="post">
                    {% csrf_token %}
                    <button class='btn btn-success' type='submit' style="margin-bottom: 20px">Start Report</button>
                </form>

            {% elif report.rep_date_sent == None %}
                Your last report has been created: {{ report.rep_date_created }}<br>
                <span style="color: red">It hasn't been sent yet. You cannot create a new one. Please close or edit the old report.</span>
                <p>
                    <form action="{% url 'reports:create' %}" method="post">
                        {% csrf_token %}
                        <button disabled="disabled" class='btn btn-success' type='submit' style="margin-bottom: 20px">Start Report</button>
                    </form>

                    <a href="{% url 'reports:summary_tab' report.rep_id %}" class='btn btn-primary' type='submit' style="margin-bottom: 20px">Edit current Report</a>

                    <form action="{% url 'reports:close' report.rep_id%}" method="post">
                        {% csrf_token %}
                        <button class='btn btn-danger' type='submit' style="margin-bottom: 20px">Close Report</button>
                    </form>

                </p>
            {% else %}
                Your last report has been created: {{ report.rep_date_created }}<br>
                <span style="color: green">It has been closed: {{ report.rep_date_sent }}</span>

                <form action="{% url 'reports:create' %}" method="post">
                    {% csrf_token %}
                    <button class='btn btn-success' type='submit' style="margin-bottom: 20px">Start Report</button>
                </form>

            {% endif %}
        </div>

        <div class="row">
            <h1>BROWSE REPORT</h1>
            <p>

                {% comment %} ponizszy link to prawie zahardcodowane przeslanie formularza, nie ma sensu bawic sie w urls bo nie dziala, slugify to konwersja int -> string {% endcomment %}

                {% with user.id|slugify as usr %}
                    <a href="{{ request.path|add:'search/?rep_user_id='|add:usr }}" class='btn btn-primary' type='submit' style="margin-bottom: 20px">Browse my reports</a>
                {% endwith %}

                <a href="{% url 'reports:search' %}" class='btn btn-primary' type='submit' style="margin-bottom: 20px">Browse all reports</a>
            </p>
        </div>
    </div>

{% endblock %}